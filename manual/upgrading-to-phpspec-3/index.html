<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1"><title>Upgrading to phpspec 3 &#8212; phpspec v6.1</title><link rel=alternate hreflang=en href=https://jaylinski.github.io/phpspec/manual/upgrading-to-phpspec-3/><link rel=icon href=https://jaylinski.github.io/phpspec/favicon.ico type=image/x-icon><link rel=stylesheet href=/phpspec/styles.min.3412609840f0f481525b1dfbc6a587423e0947a208626de5523b07aa54479ca9.css type=text/css></head><body><section><nav class=nav-main><ul><li><a href=/phpspec/>main</a></li><li><a href=/phpspec/manual/introduction/ class=nav-active>phpspec manual</a></li></ul><ul><li><a href=https://www.github.com/phpspec/phpspec target=_blank>phpspec repo</a></li><li><a href=https://www.github.com/phpspec/prophecy target=_blank>prophecy repo</a></li></ul></nav></section><section class=flex><aside><div class=nav-sidebar-headline><h3 class=h-chapter>Chapters</h3><button>Menu</button></div><nav class=nav-sidebar><ul><li><a href=/phpspec/manual/introduction/>Introduction</a><nav id=TableOfContents><ol><li><a href=#specbdd-with-phpspec>SpecBDD with phpspec</a></li><li><a href=#specbdd-and-tdd>SpecBDD and TDD</a></li><li><a href=#specbdd-and-storybdd>SpecBDD and StoryBDD</a></li></ol></nav></li><li><a href=/phpspec/manual/installation/>Installation</a><nav id=TableOfContents><ol><li><a href=#installation-process>Installation process:</a></li><li><a href=#method-1-composer-command>Method #1 (Composer command):</a></li><li><a href=#method-2-composer-config-file>Method #2 (Composer config file):</a></li><li><a href=#result>Result:</a></li></ol></nav></li><li><a href=/phpspec/manual/getting-started/>Getting Started</a><nav id=TableOfContents><ol><li><a href=#examples>Examples</a></li><li><a href=#specifying-behaviour>Specifying behaviour</a></li><li><a href=#skipping-examples>Skipping examples</a></li></ol></nav></li><li><a href=/phpspec/manual/prophet-objects/>Prophet Objects</a><nav id=TableOfContents><ol><li><a href=#stubs>Stubs</a></li><li><a href=#mocks>Mocks</a></li><li><a href=#spies>Spies</a></li></ol></nav></li><li><a href=/phpspec/manual/let-and-letgo/>Let and Let Go</a><nav id=TableOfContents></nav></li><li><a href=/phpspec/manual/upgrading-to-phpspec-7/>Upgrading to phpspec 7</a><nav id=TableOfContents></nav></li><li><a href=/phpspec/manual/upgrading-to-phpspec-6/>Upgrading to phpspec 6</a><nav id=TableOfContents></nav></li><li><a href=/phpspec/manual/upgrading-to-phpspec-5/>Upgrading to phpspec 5</a><nav id=TableOfContents></nav></li><li><a href=/phpspec/manual/upgrading-to-phpspec-4/>Upgrading to phpspec 4</a><nav id=TableOfContents><ol><li><a href=#upgrading-for-users>Upgrading for Users</a></li><li><a href=#upgrading-for-extension-authors>Upgrading for Extension Authors</a></li></ol></nav></li><li class=nav-active><a href=/phpspec/manual/upgrading-to-phpspec-3/>Upgrading to phpspec 3</a><nav id=TableOfContents><ol><li><a href=#upgrading-for-users>Upgrading for Users</a></li><li><a href=#upgrading-for-extension-authors>Upgrading for Extension Authors</a></li></ol></nav></li></ul><hr><ul><li><a href=/phpspec/cookbook/configuration/>Configuration</a><nav id=TableOfContents><ol><li><a href=#psr-4>PSR-4</a></li><li><a href=#spec-and-source-locations>Spec and source locations</a></li><li><a href=#formatter>Formatter</a></li><li><a href=#options>Options</a></li><li><a href=#extensions>Extensions</a></li><li><a href=#custom-matchers>Custom matchers</a></li><li><a href=#bootstrapping>Bootstrapping</a></li></ol></nav></li><li><a href=/phpspec/cookbook/console/>Running phpspec</a><nav id=TableOfContents><ol><li><a href=#describe-command>Describe Command</a></li><li><a href=#run-command>Run Command</a></li></ol></nav></li><li><a href=/phpspec/cookbook/construction/>Object Construction</a><nav id=TableOfContents><ol><li><a href=#using-the-constructor>Using the Constructor</a></li><li><a href=#using-a-factory-method>Using a Factory Method</a></li><li><a href=#overriding>Overriding</a></li></ol></nav></li><li><a href=/phpspec/cookbook/matchers/>Matchers</a><nav id=TableOfContents><ol><li><a href=#identity-matcher>Identity Matcher</a></li><li><a href=#comparison-matcher>Comparison Matcher</a></li><li><a href=#approximately-matcher>Approximately Matcher</a></li><li><a href=#throw-matcher>Throw Matcher</a></li><li><a href=#trigger-matcher>Trigger Matcher</a></li><li><a href=#type-matcher>Type Matcher</a></li><li><a href=#objectstate-matcher>ObjectState Matcher</a></li><li><a href=#count-matcher>Count Matcher</a></li><li><a href=#scalar-matcher>Scalar Matcher</a></li><li><a href=#iterablecontain-matcher>IterableContain Matcher</a></li><li><a href=#iterablekeywithvalue-matcher>IterableKeyWithValue Matcher</a></li><li><a href=#iterablekey-matcher>IterableKey Matcher</a></li><li><a href=#iterateas-matcher>IterateAs Matcher</a></li><li><a href=#iteratelike-matcher>IterateLike Matcher</a></li><li><a href=#startiteratingas-matcher>StartIteratingAs Matcher</a></li><li><a href=#stringcontain-matcher>StringContain Matcher</a></li><li><a href=#stringstart-matcher>StringStart Matcher</a></li><li><a href=#stringend-matcher>StringEnd Matcher</a></li><li><a href=#stringregex-matcher>StringRegex Matcher</a></li><li><a href=#inline-matcher>Inline Matcher</a></li></ol></nav></li><li><a href=/phpspec/cookbook/templates/>Templates</a><nav id=TableOfContents><ol><li><a href=#overriding-templates>Overriding templates</a></li><li><a href=#parameters>Parameters</a></li></ol></nav></li><li><a href=/phpspec/cookbook/extensions/>Extensions</a><nav id=TableOfContents><ol><li><a href=#installation>Installation</a></li><li><a href=#configuration>Configuration</a></li><li><a href=#example-extensions>Example extensions</a></li></ol></nav></li><li><a href=/phpspec/cookbook/wrapped-objects/>Working with Wrapped Objects</a><nav id=TableOfContents></nav></li></ul></nav></aside><main><h1>Upgrading to phpspec 3</h1><p>Here is a guide to upgrading a test suite or an extension, based on
BC-breaking changes made in phpspec 3.</p><h2 id=upgrading-for-users>Upgrading for Users</h2><p>If you are using 3rd party <strong>phpspec</strong> extensions, you may have to
increase the version numbers for those as well.</p><p>As PHP 5.5 and below are no longer supported language versions, you will
need to upgrade to PHP 5.6 or 7.0+ to use <strong>phpspec</strong> 3.</p><p>Where you have used <em>@param</em> annotations for spec examples, to indicate
the required type for a collaborator, you will need to remove these and
use explicit typehinting in the method signature instead. For example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#e6db74>/**
</span><span style=color:#e6db74> * @param \stdClass $collaborator
</span><span style=color:#e6db74> */</span>
<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>it_does_something_with_a_stdclass</span>($collaborator)
</code></pre></div><p>Change to:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>it_does_something_with_a_stdclass</span>(<span style=color:#a6e22e>\stdClass</span> $collaborator)
</code></pre></div><p>Extension configured in your <code>phpspec.yml</code> needs to be changed from:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>some_extension_config</span>: <span style=color:#ae81ff>foo</span>

<span style=color:#f92672>extensions</span>:
    - <span style=color:#ae81ff>SomeExtension</span>
    - <span style=color:#ae81ff>SomeOtherExtension</span>
</code></pre></div><p>To:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>extensions</span>:
    <span style=color:#f92672>SomeExtension</span>:
        <span style=color:#f92672>some_config</span>: <span style=color:#ae81ff>foo</span>

    <span style=color:#f92672>SomeOtherExtension</span>: <span style=color:#ae81ff>~</span>
</code></pre></div><h2 id=upgrading-for-extension-authors>Upgrading for Extension Authors</h2><p>Several interfaces have been renamed in <strong>phpspec</strong> 3.0. Here is a quick
guide to changes you will need to make in your code.</p><ul><li><code>PhpSpec\Console\IO</code> is now <code>PhpSpec\Console\ConsoleIO</code></li><li><code>PhpSpec\IO\IOInterface</code> is now <code>PhpSpec\IO\IO</code></li><li><code>PhpSpec\Locator\ResourceInterface</code> is now
<code>PhpSpec\Locator\Resource</code></li><li><code>PhpSpec\Locator\ResourceLocatorInterface</code> is now
<code>PhpSpec\Locator\ResourceLocator</code></li><li><code>PhpSpec\Formatter\Presenter\PresenterInterface</code> is now
<code>PhpSpec\Formatter\Presenter\Presenter</code></li><li><code>PhpSpec\CodeGenerator\Generator\GeneratorInterface</code> is now
<code>PhpSpec\CodeGenerator\Generator\Generator</code></li><li><code>PhpSpec\Extension\ExtensionInterface</code> is now <code>PhpSpec\Extension</code></li><li><code>Phpspec\CodeAnalysis\AccessInspectorInterface</code> is now
<code>Phpspec\CodeAnalysis\AccessInspector</code></li><li><code>Phpspec\Event\EventInterface</code> is now <code>Phpspec\Event\PhpSpecEvent</code></li><li><code>PhpSpec\Formatter\Presenter\Differ\EngineInterface</code> is now
<code>PhpSpec\Formatter\Presenter\Differ\DifferEngine</code></li><li><code>PhpSpec\Matcher\MatcherInterface</code> is now <code>PhpSpec\Matcher\Matcher</code></li><li><code>PhpSpec\Matcher\MatchersProviderInterface</code> is now
<code>PhpSpec\Matcher\MatchersProvider</code></li><li><code>PhpSpec\SpecificationInterface</code> is now <code>PhpSpec\Specification</code></li><li><code>PhpSpec\Runner\Maintainer\MaintainerInterface</code> is now
<code>PhpSpec\Runner\Maintainer\Maintainer</code></li></ul><p>Some methods have a different signature:</p><ul><li><code>PhpSpec\CodeGenerator\Generator\PromptingGenerator#__construct</code>&rsquo;s
third and fourth arguments are now mandatory</li><li><code>PhpSpec\Matcher\ThrowMatcher#__construct</code>&rsquo;s third argument is now
mandatory</li><li><code>PhpSpec\Extension#load</code> has now an additional mandatory
<code>array $params</code> argument.</li></ul><p>A few methods have been renamed in <strong>phpspec</strong> 3.0:</p><ul><li><code>PhpSpec\ServiceContainer#set</code> is now
<code>PhpSpec\ServiceContainer#define</code></li><li><code>PhpSpec\ServiceContainer#setShared</code> is now
<code>PhpSpec\ServiceContainer#define</code></li></ul><p>Other things to bear in mind:</p><ul><li><code>PhpSpec\ServiceContainer</code> is now an interface (available
implementation: <code>PhpSpec\ServiceContainer\IndexedServiceContainer</code>)</li><li><code>PhpSpec\ServiceContainer\ServiceContainer#getByPrefix</code> has been
replaced by <code>PhpSpec\ServiceContainer\ServiceContainer#getByTag</code>.
Tags can be set via
<code>PhpSpec\ServiceContainer\ServiceContainer#define</code>&rsquo;s third argument</li></ul><nav class=nav-pagination><ul><li><strong>Previous</strong>
<a href=https://jaylinski.github.io/phpspec/manual/upgrading-to-phpspec-4/>Upgrading to phpspec 4</a></li><li></li></ul></nav></main></section><section><footer><ul><li><a href=https://www.github.com/phpspec/phpspec/edit/master/docs/en/manual/upgrading-to-phpspec-3.md target=_blank>Improve this page</a></li></ul></footer></section></body></html>