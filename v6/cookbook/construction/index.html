<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=/phpspec/v7/cookbook/construction/><title>Object Construction &#8212; phpspec</title><link rel=alternate hreflang=en href=https://jaylinski.github.io/phpspec/v6/cookbook/construction/><link rel=icon href=https://jaylinski.github.io/phpspec/favicon.ico type=image/x-icon><link rel=stylesheet href=/phpspec/styles.min.a96f39663f75bb4d9452426e8b90189e17009551917678010a9dec08c0ae1132.css type=text/css></head><body><section><nav class=nav-main><ul><li><a href=/phpspec/>main</a></li><li><a href=/phpspec/v7/manual/introduction/>phpspec manual</a></li></ul><ul><li><a href=https://www.github.com/phpspec/phpspec target=_blank>phpspec repo</a></li><li><a href=https://www.github.com/phpspec/prophecy target=_blank>prophecy repo</a></li></ul></nav></section><section class=flex><aside><div class=nav-sidebar-headline><h3 class=h-chapter>Chapters</h3><button>Menu</button></div><nav class=nav-sidebar><section class=nav-sidebar-main><ul><li><a href=/phpspec/v6/manual/introduction/>Introduction</a><nav id=TableOfContents><ol><li><a href=#specbdd-with-phpspec>SpecBDD with phpspec</a></li><li><a href=#specbdd-and-tdd>SpecBDD and TDD</a></li><li><a href=#specbdd-and-storybdd>SpecBDD and StoryBDD</a></li></ol></nav></li><li><a href=/phpspec/v6/manual/installation/>Installation</a><nav id=TableOfContents><ol><li><a href=#installation-process>Installation process:</a></li><li><a href=#method-1-composer-command>Method #1 (Composer command):</a></li><li><a href=#method-2-composer-config-file>Method #2 (Composer config file):</a></li><li><a href=#result>Result:</a></li></ol></nav></li><li><a href=/phpspec/v6/manual/getting-started/>Getting Started</a><nav id=TableOfContents><ol><li><a href=#examples>Examples</a></li><li><a href=#specifying-behaviour>Specifying behaviour</a></li><li><a href=#skipping-examples>Skipping examples</a></li></ol></nav></li><li><a href=/phpspec/v6/manual/prophet-objects/>Prophet Objects</a><nav id=TableOfContents><ol><li><a href=#stubs>Stubs</a></li><li><a href=#mocks>Mocks</a></li><li><a href=#spies>Spies</a></li></ol></nav></li><li><a href=/phpspec/v6/manual/let-and-letgo/>Let and Let Go</a><nav id=TableOfContents></nav></li><li><a href=/phpspec/v6/manual/upgrading-to-phpspec-6/>Upgrading to phpspec 6</a><nav id=TableOfContents></nav></li><li><a href=/phpspec/v6/manual/upgrading-to-phpspec-5/>Upgrading to phpspec 5</a><nav id=TableOfContents></nav></li><li><a href=/phpspec/v6/manual/upgrading-to-phpspec-4/>Upgrading to phpspec 4</a><nav id=TableOfContents><ol><li><a href=#upgrading-for-users>Upgrading for Users</a></li><li><a href=#upgrading-for-extension-authors>Upgrading for Extension Authors</a></li></ol></nav></li><li><a href=/phpspec/v6/manual/upgrading-to-phpspec-3/>Upgrading to phpspec 3</a><nav id=TableOfContents><ol><li><a href=#upgrading-for-users>Upgrading for Users</a></li><li><a href=#upgrading-for-extension-authors>Upgrading for Extension Authors</a></li></ol></nav></li></ul><hr><ul><li><a href=/phpspec/v6/cookbook/configuration/>Configuration</a><nav id=TableOfContents><ol><li><a href=#psr-4>PSR-4</a></li><li><a href=#spec-and-source-locations>Spec and source locations</a></li><li><a href=#formatter>Formatter</a></li><li><a href=#options>Options</a></li><li><a href=#extensions>Extensions</a></li><li><a href=#custom-matchers>Custom matchers</a></li><li><a href=#bootstrapping>Bootstrapping</a></li></ol></nav></li><li><a href=/phpspec/v6/cookbook/console/>Running phpspec</a><nav id=TableOfContents><ol><li><a href=#describe-command>Describe Command</a></li><li><a href=#run-command>Run Command</a></li></ol></nav></li><li class=nav-active><a href=/phpspec/v6/cookbook/construction/>Object Construction</a><nav id=TableOfContents><ol><li><a href=#using-the-constructor>Using the Constructor</a></li><li><a href=#using-a-factory-method>Using a Factory Method</a></li><li><a href=#overriding>Overriding</a></li></ol></nav></li><li><a href=/phpspec/v6/cookbook/matchers/>Matchers</a><nav id=TableOfContents><ol><li><a href=#identity-matcher>Identity Matcher</a></li><li><a href=#comparison-matcher>Comparison Matcher</a></li><li><a href=#approximately-matcher>Approximately Matcher</a></li><li><a href=#throw-matcher>Throw Matcher</a></li><li><a href=#trigger-matcher>Trigger Matcher</a></li><li><a href=#type-matcher>Type Matcher</a></li><li><a href=#objectstate-matcher>ObjectState Matcher</a></li><li><a href=#count-matcher>Count Matcher</a></li><li><a href=#scalar-matcher>Scalar Matcher</a></li><li><a href=#iterablecontain-matcher>IterableContain Matcher</a></li><li><a href=#iterablekeywithvalue-matcher>IterableKeyWithValue Matcher</a></li><li><a href=#iterablekey-matcher>IterableKey Matcher</a></li><li><a href=#iterateas-matcher>IterateAs Matcher</a></li><li><a href=#iteratelike-matcher>IterateLike Matcher</a></li><li><a href=#startiteratingas-matcher>StartIteratingAs Matcher</a></li><li><a href=#stringcontain-matcher>StringContain Matcher</a></li><li><a href=#stringstart-matcher>StringStart Matcher</a></li><li><a href=#stringend-matcher>StringEnd Matcher</a></li><li><a href=#stringregex-matcher>StringRegex Matcher</a></li><li><a href=#inline-matcher>Inline Matcher</a></li></ol></nav></li><li><a href=/phpspec/v6/cookbook/templates/>Templates</a><nav id=TableOfContents><ol><li><a href=#overriding-templates>Overriding templates</a></li><li><a href=#parameters>Parameters</a></li></ol></nav></li><li><a href=/phpspec/v6/cookbook/extensions/>Extensions</a><nav id=TableOfContents><ol><li><a href=#installation>Installation</a></li><li><a href=#configuration>Configuration</a></li><li><a href=#example-extensions>Example extensions</a></li></ol></nav></li><li><a href=/phpspec/v6/cookbook/wrapped-objects/>Working with Wrapped Objects</a><nav id=TableOfContents></nav></li></ul></section><section class=nav-sidebar-version><h3>Version</h3><ul><li><a href=/phpspec/v7/manual/introduction/>v7&nbsp;(<strong>latest</strong>)</a></li><li class=nav-version-active><a href=/phpspec/v6/manual/introduction/>v6</a></li></ul></section></nav></aside><main><h1>Object Construction</h1><p>In <strong>phpspec</strong> specs the object you are describing is not a separate
variable but is <em>$this</em>. So instead of writing something like:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>

<span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>spec</span>;

<span style=color:#66d9ef>use</span> <span style=color:#a6e22e>PhpSpec\ObjectBehavior</span>;

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MarkdownSpec</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ObjectBehavior</span>
{
    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>it_converts_plain_text_to_html_paragraphs</span>()
    {
        $markdown <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Markdown</span>();
        $markdown<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toHtml</span>(<span style=color:#e6db74>&#34;Hi, there&#34;</span>)<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>shouldReturn</span>(<span style=color:#e6db74>&#34;&lt;p&gt;Hi, there&lt;/p&gt;&#34;</span>);
    }
}
</code></pre></div><p>as you might with other tools, you write:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>

<span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>spec</span>;

<span style=color:#66d9ef>use</span> <span style=color:#a6e22e>PhpSpec\ObjectBehavior</span>;

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MarkdownSpec</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ObjectBehavior</span>
{
    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>it_converts_plain_text_to_html_paragraphs</span>()
    {
        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toHtml</span>(<span style=color:#e6db74>&#34;Hi, there&#34;</span>)<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>shouldReturn</span>(<span style=color:#e6db74>&#34;&lt;p&gt;Hi, there&lt;/p&gt;&#34;</span>);
    }
}
</code></pre></div><p>On consequence this means that you do not construct the object you are
describing in the examples. Instead <strong>phpspec</strong> handles the creation of
the object you are describing when you run the specs.</p><p>The default way <strong>phpspec</strong> does this is the same as <code>new Markdown()</code>.
If it does not need any values or dependencies to be passed to it then
this is fine but for many objects this will not be good enough. You can
tell <strong>phpspec</strong> how you want it to create the object though.</p><h2 id=using-the-constructor>Using the Constructor</h2><p>You can tell <strong>phpspec</strong> to pass values to the constructor when it
constructs the object:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>

<span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>spec</span>;

<span style=color:#66d9ef>use</span> <span style=color:#a6e22e>PhpSpec\ObjectBehavior</span>;
<span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Markdown\Writer</span>;

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MarkdownSpec</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ObjectBehavior</span>
{
    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>it_outputs_converted_text</span>(<span style=color:#a6e22e>Writer</span> $writer)
    {
        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>beConstructedWith</span>($writer);
        $writer<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>writeText</span>(<span style=color:#e6db74>&#34;&lt;p&gt;Hi, there&lt;/p&gt;&#34;</span>)<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>shouldBeCalled</span>();

        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>outputHtml</span>(<span style=color:#e6db74>&#34;Hi, there&#34;</span>);
    }
}
</code></pre></div><h2 id=using-a-factory-method>Using a Factory Method</h2><p>You may not want to use the constructor but use static factory methods
to create the class. This allows you to create it in different ways for
different use cases since you can only have a single constructor in PHP.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>

<span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Markdown\Writer</span>;

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Markdown</span>
{
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>createForWriting</span>(<span style=color:#a6e22e>Writer</span> $writer)
    {
        $markdown <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Self</span>();
        $markdown<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>writer</span> <span style=color:#f92672>=</span> $writer;

        <span style=color:#66d9ef>return</span> $markdown;
    }
}
</code></pre></div><p>You can tell <strong>phpspec</strong> this is how you want to construct the object as
follows:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>

<span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>spec</span>;

<span style=color:#66d9ef>use</span> <span style=color:#a6e22e>PhpSpec\ObjectBehavior</span>;
<span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Markdown\Writer</span>;

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MarkdownSpec</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ObjectBehavior</span>
{
    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>it_outputs_converted_text</span>(<span style=color:#a6e22e>Writer</span> $writer)
    {
        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>beConstructedThrough</span>(<span style=color:#e6db74>&#39;createForWriting&#39;</span>, [$writer]);
        $writer<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>writeText</span>(<span style=color:#e6db74>&#34;&lt;p&gt;Hi, there&lt;/p&gt;&#34;</span>)<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>shouldBeCalled</span>();

        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>outputHtml</span>(<span style=color:#e6db74>&#34;Hi, there&#34;</span>);
    }
}
</code></pre></div><p>Where the first argument is the method name and the second an array of
the values to pass to that method.</p><p>To be more descriptive, shorter syntaxes are available. All of the
following are equivalent:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>beConstructedNamed</span>(<span style=color:#e6db74>&#39;Bob&#39;</span>);
$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>beConstructedThroughNamed</span>(<span style=color:#e6db74>&#39;Bob&#39;</span>);
$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>beConstructedThrough</span>(<span style=color:#e6db74>&#39;Named&#39;</span>, <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;Bob&#39;</span>));
</code></pre></div><h2 id=overriding>Overriding</h2><p>To avoid repetition you can tell <strong>phpspec</strong> how to construct the object
in let. However, you may have a single example that needs constructing
in a different way. You can do this by calling <code>beConstructedWith</code> again
in the example. The last time you call <code>beConstructedWith</code> will
determine how <strong>phpspec</strong> constructs the object:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>

<span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>spec</span>;

<span style=color:#66d9ef>use</span> <span style=color:#a6e22e>PhpSpec\ObjectBehavior</span>;
<span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Markdown\Writer</span>;

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MarkdownSpec</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ObjectBehavior</span>
{
    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>let</span>(<span style=color:#a6e22e>Writer</span> $writer)
    {
        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>beConstructedWith</span>($writer, <span style=color:#66d9ef>true</span>);
    }

    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>it_outputs_converted_text</span>(<span style=color:#a6e22e>Writer</span> $writer)
    {
        <span style=color:#75715e>// constructed with second argument set to true
</span><span style=color:#75715e></span>        <span style=color:#75715e>// ...
</span><span style=color:#75715e></span>    }

    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>it_does_something_if_argument_is_false</span>(<span style=color:#a6e22e>Writer</span> $writer)
    {
        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>beConstructedWith</span>($writer, <span style=color:#66d9ef>false</span>);
        <span style=color:#75715e>// constructed with second argument set to false
</span><span style=color:#75715e></span>        <span style=color:#75715e>// ...
</span><span style=color:#75715e></span>    }
}
</code></pre></div><nav class=nav-pagination><ul><li><strong>Previous</strong>
<a href=https://jaylinski.github.io/phpspec/v6/manual/getting-started/>Getting Started</a></li><li><strong>Next</strong>
<a href=https://jaylinski.github.io/phpspec/v6/cookbook/matchers/>Matchers</a></li></ul></nav></main></section><section><footer><ul><li><a href=https://www.github.com/phpspec/phpspec/edit/main/docs/en/v6/cookbook/construction.md target=_blank>Improve this page</a></li></ul></footer></section></body></html>